let s:V = vital#of('vital')
let s:Prelude = s:V.import('Prelude')
let s:Path = s:V.import('System.Filepath')
let s:ScriptLocal = s:V.import('Vim.ScriptLocal')

Describe gita#command#show
  Before
    let scriptfile = s:Path.realpath(
          \ 'autoload/gita/command/show.vim',
          \)
    let sf = s:ScriptLocal.sfuncs(scriptfile)
  End

  Describe s:replace_filenames_in_diff({content}, {filename1}, {filename2}, {repl})
    It replace {filename1} and {filename2} in the header of {content} into {repl}
      let tempfile = tempname()
      let filename1 = tempfile . '.index'
      let filename2 = tempfile . '.buffer'
      let content = [
            \ printf('diff --git a%s b%s',
            \   (filename1 =~# '^/' ? '' : '/') . filename1,
            \   (filename2 =~# '^/' ? '' : '/') . filename2,
            \ ),
            \ 'index ZZZZZZZZZZ..ZZZZZZZZZZ ZZZZZZZZZZ',
            \ printf('--- a%s',
            \   (filename1 =~# '^/' ? '' : '/') . filename1,
            \ ),
            \ printf('+++ b%s',
            \   (filename2 =~# '^/' ? '' : '/') . filename2,
            \ ),
            \ ' brabrabra',
            \]
      let repl = 'autoload/gita.vim'
      let result = sf.replace_filenames_in_diff(content, filename1, filename2, repl)
      Assert Equals(result, [
            \ 'diff --git a/autoload/gita.vim b/autoload/gita.vim', 
            \ 'index ZZZZZZZZZZ..ZZZZZZZZZZ ZZZZZZZZZZ',
            \ '--- a/autoload/gita.vim',
            \ '+++ b/autoload/gita.vim',
            \ ' brabrabra',
            \])
    End
  End
End
