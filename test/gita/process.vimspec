Describe gita#process
  Before all
    let V = vital#of('vital')
    let Path = V.import('System.Filepath')
    let ScriptLocal = V.import('Vim.ScriptLocal')
    let sf = ScriptLocal.sfuncs(Path.realpath('autoload/gita/process.vim'))
  End

  Describe s:translate({key}, {options}, {scheme})
    It returns ['-X'] for ('X', { 'X': 1 }, '')
      let ret = sf.translate('X', { 'X': 1 }, '')
      Assert Equals(ret, ['-X'])
    End

    It returns ['--KEY'] for ('KEY', { 'KEY': 1 }, '')
      let ret = sf.translate('KEY', { 'KEY': 1 }, '')
      Assert Equals(ret, ['--KEY'])
    End

    It returns ['KEY'] for ('KEY', { 'KEY': 'VALUE' }, '%k')
      let ret = sf.translate('KEY', { 'KEY': 'VALUE' }, '%k')
      Assert Equals(ret, ['KEY'])
    End

    It returns ['VALUE'] for ('KEY', { 'KEY': 'VALUE' }, '%v')
      let ret = sf.translate('KEY', { 'KEY': 'VALUE' }, '%v')
      Assert Equals(ret, ['VALUE'])
    End

    It returns ['--KEY=VALUE'] for ('KEY', { 'KEY': 'VALUE' }, '--%k=%v')
      let ret = sf.translate('KEY', { 'KEY': 'VALUE' }, '--%k=%v')
      Assert Equals(ret, ['--KEY=VALUE'])
    End

    It returns ['--KEY=V A L U E'] for ('KEY', { 'KEY': 'V A L U E' }, '--%k=%v')
      let ret = sf.translate('KEY', { 'KEY': 'V A L U E' }, '--%k=%v')
      Assert Equals(ret, ['--KEY=V A L U E'])
    End

    It returns ['--KEY', 'VALUE'] for ('KEY', { 'KEY': 'VALUE' }, '--%k %v')
      let ret = sf.translate('KEY', { 'KEY': 'VALUE' }, '--%k %v')
      Assert Equals(ret, ['--KEY', 'VALUE'])
    End

    It returns ['--KEY', 'V A L U E'] for ('KEY', { 'KEY': 'V A L U E' }, '--%k %v')
      let ret = sf.translate('KEY', { 'KEY': 'V A L U E' }, '--%k %v')
      Assert Equals(ret, ['--KEY', 'V A L U E'])
    End

    It returns ['-Xv1', '-Xv2', '-Xv3'] for ('X', { 'X': ['v1', 'v2', 'v3'] }, '-%k%v')
      let ret = sf.translate('X', { 'X': ['v1', 'v2', 'v3'] }, '-%k%v')
      Assert Equals(ret, ['-Xv1', '-Xv2', '-Xv3'])
    End
  End

  Describe s:strip_quotes({value})
    It strips leading and trailing single quotes
      Assert Equals(sf.strip_quotes("'foo'"), 'foo')
      Assert Equals(sf.strip_quotes("'foo bar'"), 'foo bar')
    End

    It strips leading and trailing double quotes
      Assert Equals(sf.strip_quotes('"foo"'), 'foo')
      Assert Equals(sf.strip_quotes('"foo bar"'), 'foo bar')
    End

    It strips leading and trailing single quotes of -k='value' or --key='value'
      Assert Equals(sf.strip_quotes("-k='foo'"), '-k=foo')
      Assert Equals(sf.strip_quotes("-k='foo bar'"), '-k=foo bar')
      Assert Equals(sf.strip_quotes("--key='foo'"), '--key=foo')
      Assert Equals(sf.strip_quotes("--key='foo bar'"), '--key=foo bar')
    End

    It strips leading and trailing double quotes of -k="value" or --key="value"
      Assert Equals(sf.strip_quotes('-k="foo"'), '-k=foo')
      Assert Equals(sf.strip_quotes('-k="foo bar"'), '-k=foo bar')
      Assert Equals(sf.strip_quotes('--key="foo"'), '--key=foo')
      Assert Equals(sf.strip_quotes('--key="foo bar"'), '--key=foo bar')
    End
  End

  Describe #execute({git}, {args}[, {options}])
    It executes a {args}
      let git = gita#core#get_or_fail()
      let content = gita#process#execute(
            \ git,
            \ ['rev-parse', '--is-inside-work-tree']
            \)
      Assert Equals(content, ['true'])
    End
  End
End

